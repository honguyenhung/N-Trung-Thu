<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cho n√®</title>
  <link href="https://fonts.googleapis.com/css2?family=Mali:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent:#ff7f50; --accent-2:#ff5722; }

    html, body {
      height: 100%; margin: 0;
      font-family: "Mali", cursive;
      background: #060614; overflow: hidden;
    }

    .stage { position: relative; min-height: 100vh; overflow: hidden; }
    canvas#starfield { display:block; width:100%; height:100%; }

    .moon {
      position: absolute; top: 60px; right: 100px;
      width: 160px; height: 160px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff 0%, #f8f8f8 70%, #e0e0e0 100%);
      box-shadow: 0 0 60px rgba(255,255,220,.8); z-index: 10;
    }
    @media (max-width:600px){ .moon{top:40px; right:14px; width:70px; height:70px;} }

    /* ƒê√®n l·ªìng */
    #lantern-container{
      position: fixed; inset:0;
      pointer-events: none; overflow: hidden; z-index: 9;
    }
    .lantern{ position:absolute; width:40px; user-select:none; pointer-events:auto; }
    @keyframes swing{ 0%{transform:rotate(-5deg)} 50%{transform:rotate(5deg)} 100%{transform:rotate(-5deg)} }
    .swing{ animation: swing 2s ease-in-out infinite; }

    /* Popup l·ªùi ch√∫c */
    #wish-popup{
      position: fixed; top: 55%; left: 50%;
      transform: translate(-50%,-50%);
      background: rgba(255,255,255,.96);
      color:#ff8d22; padding: 25px 35px; border-radius: 18px;
      font-size:1.8rem; font-weight:700; display:none; z-index:9999;
      text-align:center; white-space:nowrap;
      text-shadow: 0 0 12px #ffd180;
      box-shadow: 0 0 25px #ff8a50, 0 0 35px #ffd180;
    }
    @media (max-width:600px){ #wish-popup{font-size:1.2rem; padding:16px 20px; white-space:normal; max-width:85%;} }

    @keyframes slideIn{
      0%{opacity:0; transform: translate(-50%,-30px);}
      100%{opacity:1; transform: translate(-50%,-50%);}
    }
    @keyframes slideOut{
      0%{opacity:1; transform: translate(-50%,-50%);}
      100%{opacity:0; transform: translate(-50%,-70px);}
    }
    .show{ display:block; animation: slideIn .8s ease forwards; }
    .hide{ animation: slideOut .8s ease forwards; }

    #hint{
      position: fixed; bottom:80px; left:50%; transform:translateX(-50%);
      color:#ffa722; font-size:24px; font-weight:700; opacity:0; transition:.5s;
      text-shadow:0 0 10px #ff8a50; z-index: 8;
    }

    /* L·ªùi ch√∫c cu·ªëi "Ng·ªß ngon" */
    #goodnight {
      position: fixed;
      top: 60%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2rem;
      color: #ffb347;
      text-shadow: 0 0 20px #ffd180, 0 0 40px #ff8a50;
      opacity: 0;
      z-index: 9999;
      font-weight: 700;
      transition: opacity 1.2s ease;
      animation: floaty 3s ease-in-out infinite alternate;
    }
    @keyframes floaty {
      0% { transform: translate(-50%, -52%); }
      100% { transform: translate(-50%, -48%); }
    }
  </style>
</head>

<body>
  <div class="stage">
    <canvas id="starfield"></canvas>
    <div class="moon"></div>

    <!-- ƒê√®n l·ªìng -->
    <div id="lantern-container"></div>

    <!-- Popup l·ªùi ch√∫c -->
    <div id="wish-popup" role="dialog" aria-live="polite"></div>

    <!-- L·ªùi ch√∫c k·∫øt -->
    <div id="goodnight">üí§ Ch√∫c b·∫°n y√™u ng·ªß ngon nhaaa üíñ</div>

    <div id="hint">Ch·∫°m v√†o ƒë√®n tr·ªùi</div>

    <audio id="bg-music" loop>
      <source src="a.mp3" type="audio/mp3">
    </audio>
  </div>

  <script>
    // ===== N·ªÅn sao =====
    const canvas = document.getElementById("starfield");
    const ctx = canvas.getContext("2d");
    let w,h,stars=[];
    function resizeCanvas(){
      w = canvas.width = innerWidth;
      h = canvas.height = innerHeight;
      stars = [];
      for(let i=0;i<(w*h)/2200;i++){
        stars.push({x:Math.random()*w,y:Math.random()*h,r:Math.random()*1+0.2,a:Math.random(),t:Math.random()*0.02+0.002});
      }
    }
    function drawStars(){
      ctx.clearRect(0,0,w,h);
      for(const s of stars){
        s.a += (Math.random()>0.5?1:-1)*s.t;
        ctx.globalAlpha = Math.max(.05,Math.min(1,s.a));
        ctx.fillStyle="#fff"; ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill();
      }
      ctx.globalAlpha = 1;
      requestAnimationFrame(drawStars);
    }
    resizeCanvas(); window.addEventListener("resize",resizeCanvas); drawStars();

    // ===== ƒê√®n l·ªìng bay =====
    const lanternContainer = document.getElementById("lantern-container");
    function createLantern(){
      const lantern = document.createElement("img");
      lantern.src = "./den.png";
      lantern.className = "lantern swing";
      const layer = Math.floor(Math.random()*3)+1;
      let size=40, duration=10000, opacity=.8;
      if(layer===1){ size=20+Math.random()*20; duration=14000+Math.random()*5000; opacity=.5; }
      else if(layer===2){ size=30+Math.random()*30; duration=12000+Math.random()*4000; opacity=.7; }
      else { size=40+Math.random()*40; duration=10000+Math.random()*3000; opacity=.95; }
      lantern.style.width = size+"px";
      lantern.style.left = Math.random()*90 + "vw";
      lantern.style.bottom = "0px";
      lantern.style.opacity = opacity;
      lanternContainer.appendChild(lantern);
      const drift = Math.random()*140 - 70;
      const up = 120 + Math.random()*40;
      lantern.animate(
        [{transform:"translate(0,0)", opacity:opacity},{transform:`translate(${drift}px, -${up}vh)`, opacity:0}],
        {duration, easing:"linear", fill:"forwards"}
      );
      setTimeout(()=>lantern.remove(), duration);
    }
    setInterval(createLantern, 500);

    // ===== Nh·∫°c n·ªÅn =====
    const bg = document.getElementById("bg-music");
    const hint = document.getElementById("hint");
    let musicStarted=false;
    document.addEventListener("pointerdown", function startMusicOnce(){
      if(!musicStarted && bg){
        bg.volume=0;
        bg.play().then(()=>{
          let v=0; const fade=setInterval(()=>{ v+=.05; if(v>=.9){v=.9; clearInterval(fade);} bg.volume=v; },120);
          musicStarted=true;
        }).catch(()=>{});
      }
      document.removeEventListener("pointerdown", startMusicOnce);
    });

    // ===== L·ªùi ch√∫c ch√≠nh =====
    const wishes = [
      "Ch√∫c b·∫°n Nhi Trung Thu ·∫•m √°p, h·∫°nh ph√∫c!",
      "Ch√∫c gia ƒë√¨nh b·∫°n ƒëo√†n vi√™n, vui v·∫ª!",
      "M√πa trƒÉng an l√†nh v√† ng·ªçt ng√†o!",
      "Ch√∫c b·∫°n lu√¥n s√°ng nh∆∞ trƒÉng r·∫±m!",
      "Mong ∆∞·ªõc th√†nh hi·ªán th·ª±c nh√©!"
    ];
    const popup = document.getElementById("wish-popup");
    const goodnight = document.getElementById("goodnight");
    let idx = 0, timer = null;

    function showNextWish(){
      if(idx >= wishes.length){
        popup.classList.remove("show");
        popup.classList.add("hide");
        popup.addEventListener("animationend", ()=>{
          popup.style.display="none";
          // sau 3s hi·ªán d√≤ng ch√∫c ng·ªß ngon
          setTimeout(()=>{ goodnight.style.opacity = "1"; }, 3000);
        }, {once:true});
        clearInterval(timer);
        return;
      }
      popup.classList.remove("hide");
      if(popup.textContent){
        popup.classList.add("hide");
        popup.addEventListener("animationend", function onOut(){
          popup.removeEventListener("animationend", onOut);
          popup.textContent = wishes[idx++];
          popup.classList.remove("hide");
          popup.classList.add("show");
        }, {once:true});
      }else{
        popup.style.display="block";
        popup.textContent = wishes[idx++];
        popup.classList.add("show");
      }
    }

    setTimeout(()=>{
      showNextWish();
      timer = setInterval(showNextWish, 2000);
    }, 2000);

    // Hint xu·∫•t hi·ªán r·ªìi m·ªù d·∫ßn
    setTimeout(()=>{ hint.style.opacity="1"; setTimeout(()=>hint.style.opacity="0", 5000); }, 1000);
  </script>
</body>
</html>
